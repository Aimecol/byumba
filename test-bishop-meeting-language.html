<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Bishop Meeting Language Switching</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .language-buttons {
            margin: 20px 0;
        }
        .lang-btn {
            padding: 10px 20px;
            margin: 5px;
            border: 1px solid #ccc;
            background: #f5f5f5;
            cursor: pointer;
            border-radius: 5px;
        }
        .lang-btn.active {
            background: #007cba;
            color: white;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 3px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <h1>Bishop Meeting Language Switching Test</h1>
    
    <div class="language-buttons">
        <h3>Language Selection:</h3>
        <button class="lang-btn active" data-lang="en">English</button>
        <button class="lang-btn" data-lang="rw">Kinyarwanda</button>
        <button class="lang-btn" data-lang="fr">Français</button>
    </div>

    <div class="test-section">
        <h3>Test Results:</h3>
        <div id="testResults"></div>
    </div>

    <div class="test-section">
        <h3>Sample Translations:</h3>
        <div id="sampleTranslations">
            <p><strong>Page Title:</strong> <span id="pageTitle" data-translate="schedule_meeting_title">Schedule a Meeting with the Bishop</span></p>
            <p><strong>Form Label:</strong> <span id="firstName" data-translate="first_name">First Name *</span></p>
            <p><strong>Button:</strong> <span id="submitBtn" data-translate="submit_meeting_request">Submit Meeting Request</span></p>
            <p><strong>Validation:</strong> <span id="validation" data-translate="field_required">This field is required.</span></p>
        </div>
    </div>

    <script src="js/language.js"></script>
    <script src="js/script.js"></script>
    <script src="js/bishop-meeting.js"></script>
    
    <script>
        // Note: currentLanguage is declared in bishop-meeting.js
        let testResults = [];

        // Test function
        function runLanguageTests() {
            const resultsDiv = document.getElementById('testResults');
            testResults = [];

            // Test 1: Check if language manager is loaded
            if (typeof window.languageManager !== 'undefined') {
                testResults.push({type: 'success', message: '✓ Language Manager loaded successfully'});
            } else {
                testResults.push({type: 'error', message: '✗ Language Manager not found'});
            }

            // Test 2: Check if bishop meeting functions are available
            if (typeof window.updateBishopMeetingContent === 'function') {
                testResults.push({type: 'success', message: '✓ Bishop Meeting language functions available'});
            } else {
                testResults.push({type: 'error', message: '✗ Bishop Meeting language functions not found'});
            }

            // Test 3: Check if getTranslation function works
            try {
                const translation = getTranslation('schedule_meeting_title');
                if (translation && translation !== 'schedule_meeting_title') {
                    testResults.push({type: 'success', message: '✓ Translation function working'});
                } else {
                    testResults.push({type: 'error', message: '✗ Translation function not working properly'});
                }
            } catch (e) {
                testResults.push({type: 'error', message: '✗ Translation function error: ' + e.message});
            }

            // Display results
            resultsDiv.innerHTML = testResults.map(result => 
                `<div class="test-result ${result.type}">${result.message}</div>`
            ).join('');
        }

        // Language switching test
        function testLanguageSwitch(lang) {
            // Update global currentLanguage if it exists
            if (typeof currentLanguage !== 'undefined') {
                currentLanguage = lang;
            }

            // Update active button
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-lang') === lang) {
                    btn.classList.add('active');
                }
            });

            // Use the language manager if available
            if (window.languageManager && typeof window.languageManager.changeLanguage === 'function') {
                window.languageManager.changeLanguage(lang);
            } else {
                // Fallback: Update sample translations manually
                document.querySelectorAll('[data-translate]').forEach(element => {
                    const key = element.getAttribute('data-translate');
                    const translation = getTranslation(key);
                    if (translation) {
                        element.textContent = translation;
                    }
                });

                // Trigger language change event
                const event = new CustomEvent('languageChanged', {
                    detail: { language: lang }
                });
                document.dispatchEvent(event);
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Run tests after a short delay to ensure everything is loaded
            setTimeout(runLanguageTests, 1000);

            // Add language button event listeners
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const lang = this.getAttribute('data-lang');
                    testLanguageSwitch(lang);
                });
            });
        });

        // Re-run tests when language changes
        document.addEventListener('languageChanged', function() {
            setTimeout(runLanguageTests, 500);
        });
    </script>
</body>
</html>
